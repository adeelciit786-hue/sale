{% extends "base.html" %}

{% block title %}Dashboard - Sales Forecasting{% endblock %}

{% block content %}

<div class="kpi-grid">
    <div class="kpi-card">
        <div class="kpi-label">Today's Date</div>
        <div class="kpi-value">{{ data.kpis.today_date }}</div>
    </div>

    <div class="kpi-card">
        <div class="kpi-label">Total Sales</div>
        <div class="kpi-value">{{ data.kpis.total_sales_till_today }}</div>
    </div>

    <div class="kpi-card">
        <div class="kpi-label">Monthly Target</div>
        <div class="kpi-value">{{ data.kpis.monthly_target }}</div>
    </div>
</div>

<div class="graph-container">
    <h3>Historical Daily Sales Trend</h3>
    <div id="graph-historical"></div>
</div>

<div class="graph-container">
    <h3>Average Sales by Weekday</h3>
    <div id="graph-weekday"></div>
</div>

{% if data.graphs.monthly_forecast %}
<div class="graph-container">
    <h3>Current Month Forecast</h3>
    <div id="graph-forecast"></div>
</div>
{% endif %}

{% block extra_js %}
<script>
    const graphs = {{ data.graphs | tojson }};

    if (graphs.historical_trend && graphs.historical_trend !== "{}") {
        const g = JSON.parse(graphs.historical_trend);
        Plotly.newPlot("graph-historical", g.data, g.layout);
    }

    if (graphs.weekday_avg && graphs.weekday_avg !== "{}") {
        const g = JSON.parse(graphs.weekday_avg);
        Plotly.newPlot("graph-weekday", g.data, g.layout);
    }

    if (graphs.monthly_forecast && graphs.monthly_forecast !== "{}") {
        const g = JSON.parse(graphs.monthly_forecast);
        Plotly.newPlot("graph-forecast", g.data, g.layout);
    }
</script>
{% endblock %}

{% endblock %}
