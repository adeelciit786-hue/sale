{% extends "base.html" %}

{% block title %}Dashboard - Sales Forecasting{% endblock %}

{% block extra_css %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}

{% block content %}

<div class="container">

    <!-- KPI CARDS -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-label">Today's Date</div>
            <div class="kpi-value">{{ data.kpis.today_date }}</div>
        </div>

        <div class="kpi-card">
            <div class="kpi-label">Total Sales</div>
            <div class="kpi-value">
                {{ data.kpis.total_sales | default("AED 0") }}
            </div>
        </div>

        <div class="kpi-card">
            <div class="kpi-label">Monthly Target</div>
            <div class="kpi-value">
                {{ data.kpis.monthly_target | default("AED 0") }}
            </div>
        </div>
    </div>

    <!-- HISTORICAL TREND -->
    <div class="graph-container">
        <h3 class="graph-title">Daily Sales Trend (Historical)</h3>
        <div id="graph-historical-trend"></div>
    </div>

    <!-- WEEKDAY AVERAGE -->
    <div class="graph-container">
        <h3 class="graph-title">Average Sales by Weekday</h3>
        <div id="graph-weekday-avg"></div>
    </div>

    <!-- MONTHLY FORECAST -->
    <div class="graph-container">
        <h3 class="graph-title">Current Month Forecast</h3>
        <div id="graph-monthly-forecast"></div>
    </div>

</div>

<script>
const graphs = {{ data.graphs | tojson }};

function safePlot(id, chart) {
    if (!chart || chart === '{}') return;
    const parsed = JSON.parse(chart);
    Plotly.newPlot(id, parsed.data, parsed.layout);
}

document.addEventListener("DOMContentLoaded", function () {
    safePlot("graph-historical-trend", graphs.historical_trend);
    safePlot("graph-weekday-avg", graphs.weekday_avg);
    safePlot("graph-monthly-forecast", graphs.monthly_forecast);
});
</script>

{% endblock %}
